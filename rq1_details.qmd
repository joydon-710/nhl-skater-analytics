---

title: "RQ1 Detailed Analysis: Shift Efficiency"
format:
  html:
    theme: cosmo
    toc: true
    code-fold: true
---


## 1. Introduction

This section provides a detailed analysis for **Research Question 1 (RQ1)**, which investigates how efficiently NHL skaters contribute to expected goals during their on-ice shifts. Shift-level performance is crucial in hockey analytics because it captures short, repeatable bursts of play that reflect a playerâ€™s immediate offensive and defensive impact.

We quantify efficiency using **expected goals for and against after shifts**, normalized by the number of shifts played. This allows fair comparison across players with different usage levels.

---

## 2. Data Preparation

### 2.1 Load Required Libraries

```{r}
library(tidyverse)
library(knitr)
library(ggplot2)
```


### 2.2 Load Dataset

```{r}
df <- read_csv("D:/GMU homeworks/STAT515/final proj/skaters.csv")
```


### 2.3 Standardize Column Names

The raw dataset uses `name` for player names and `icetime` for time on ice. These are renamed for consistency across all research questions.
```{r}
df <- df %>%
  rename(
    player = name,
    toi = icetime
  )
```


### 2.4 Validate Required Columns

```{r}
req_cols <- c(
  "player",
  "season",
  "shifts",
  "xGoalsForAfterShifts",
  "xGoalsAgainstAfterShifts"
)

missing_cols <- setdiff(req_cols, names(df))

if (length(missing_cols) > 0) {
  stop("Missing required columns: ", paste(missing_cols, collapse = ", "))
}
```


---

## 3. Feature Engineering

### 3.1 Construct Shift Efficiency Metric

We define **Average Shift Efficiency** as:

[
\text{Avg Shift Efficiency} = \frac{xGF_{after\ shifts} - xGA_{after\ shifts}}{\text{Total Shifts}}
]

This metric captures net expected goal contribution per shift.

```{r}
df <- df %>%
  mutate(
    shifts = as.numeric(shifts),
    xgf_shift = as.numeric(xGoalsForAfterShifts),
    xga_shift = as.numeric(xGoalsAgainstAfterShifts),
    avg_shift_eff = ifelse(
      is.na(shifts) | shifts <= 0,
      NA_real_,
      (xgf_shift - xga_shift) / shifts
    )
  )
```


---

## 4. Results

### 4.1 Top Players by Shift Efficiency

```{r}
df %>%
  arrange(desc(avg_shift_eff)) %>%
  select(player, season, shifts, xgf_shift, xga_shift, avg_shift_eff) %>%
  head(12) %>%
  kable(caption = "Top Players by Average Shift Efficiency")
```


This table highlights players who consistently generate positive expected goal impact during their shifts.

---

### 4.2 Distribution of Shift Efficiency
```{r}
ggplot(df, aes(x = avg_shift_eff)) +
  geom_histogram(bins = 40, fill = "steelblue", alpha = 0.75) +
  labs(
    title = "Distribution of Average Shift Efficiency",
    x = "Average Shift Efficiency",
    y = "Number of Players"
  ) +
  theme_minimal()
```


The distribution shows that most players cluster around neutral efficiency, while a smaller subset exhibits consistently strong positive or negative contributions.

---

### 4.3 Relationship Between TOI and Shift Efficiency

```{r}
ggplot(df, aes(x = toi, y = avg_shift_eff)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "loess", se = FALSE) +
  labs(
    title = "Average Shift Efficiency vs Time on Ice",
    x = "Time on Ice",
    y = "Average Shift Efficiency"
  ) +
  theme_minimal()
```


This visualization examines whether higher ice-time players maintain efficiency or regress due to fatigue and tougher matchups.

---

## 5. Interpretation

Players with high average shift efficiency contribute positively in short, repeatable segments of play, indicating strong two-way impact. Importantly, efficiency does not scale linearly with ice time, suggesting that role and deployment significantly influence performance.

These findings reinforce the value of shift-normalized metrics when comparing players across teams and usage levels.

---

## 6. Conclusion

RQ1 demonstrates that expected-goal-based shift efficiency provides a nuanced and fair evaluation of player performance. This metric serves as a foundation for subsequent analyses that explore contextual factors such as zone starts, usage, and on-ice teammates in later research questions.


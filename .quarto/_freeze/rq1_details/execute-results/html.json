{
  "hash": "f49f223608168ced9a2ab9dab2ab8f3e",
  "result": {
    "engine": "knitr",
    "markdown": "---\n\ntitle: \"RQ1 Detailed Analysis: Shift Efficiency\"\nformat:\n  html:\n    theme: cosmo\n    toc: true\n    code-fold: true\n---\n\n\n\n\n\n## 1. Introduction\n\nThis section provides a detailed analysis for **Research Question 1 (RQ1)**, which investigates how efficiently NHL skaters contribute to expected goals during their on-ice shifts. Shift-level performance is crucial in hockey analytics because it captures short, repeatable bursts of play that reflect a player’s immediate offensive and defensive impact.\n\nWe quantify efficiency using **expected goals for and against after shifts**, normalized by the number of shifts played. This allows fair comparison across players with different usage levels.\n\n---\n\n## 2. Data Preparation\n\n### 2.1 Load Required Libraries\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tidyverse' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'ggplot2' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tibble' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tidyr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'readr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'purrr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'dplyr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'stringr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'forcats' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'lubridate' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(knitr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'knitr' was built under R version 4.5.2\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\n```\n:::\n\n\n\n\n\n### 2.2 Load Dataset\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read_csv(\"D:/GMU homeworks/STAT515/final proj/skaters.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 4600 Columns: 154\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (4): name, team, position, situation\ndbl (150): playerId, season, games_played, icetime, shifts, gameScore, onIce...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n\n\n\n### 2.3 Standardize Column Names\n\nThe raw dataset uses `name` for player names and `icetime` for time on ice. These are renamed for consistency across all research questions.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df %>%\n  rename(\n    player = name,\n    toi = icetime\n  )\n```\n:::\n\n\n\n\n\n### 2.4 Validate Required Columns\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreq_cols <- c(\n  \"player\",\n  \"season\",\n  \"shifts\",\n  \"xGoalsForAfterShifts\",\n  \"xGoalsAgainstAfterShifts\"\n)\n\nmissing_cols <- setdiff(req_cols, names(df))\n\nif (length(missing_cols) > 0) {\n  stop(\"Missing required columns: \", paste(missing_cols, collapse = \", \"))\n}\n```\n:::\n\n\n\n\n\n---\n\n## 3. Feature Engineering\n\n### 3.1 Construct Shift Efficiency Metric\n\nWe define **Average Shift Efficiency** as:\n\n[\n\\text{Avg Shift Efficiency} = \\frac{xGF_{after\\ shifts} - xGA_{after\\ shifts}}{\\text{Total Shifts}}\n]\n\nThis metric captures net expected goal contribution per shift.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df %>%\n  mutate(\n    shifts = as.numeric(shifts),\n    xgf_shift = as.numeric(xGoalsForAfterShifts),\n    xga_shift = as.numeric(xGoalsAgainstAfterShifts),\n    avg_shift_eff = ifelse(\n      is.na(shifts) | shifts <= 0,\n      NA_real_,\n      (xgf_shift - xga_shift) / shifts\n    )\n  )\n```\n:::\n\n\n\n\n\n---\n\n## 4. Results\n\n### 4.1 Top Players by Shift Efficiency\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n  arrange(desc(avg_shift_eff)) %>%\n  select(player, season, shifts, xgf_shift, xga_shift, avg_shift_eff) %>%\n  head(12) %>%\n  kable(caption = \"Top Players by Average Shift Efficiency\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Top Players by Average Shift Efficiency\n\n|player            | season| shifts| xgf_shift| xga_shift| avg_shift_eff|\n|:-----------------|------:|------:|---------:|---------:|-------------:|\n|Helge Grans       |   2024|      1|      0.27|         0|     0.2700000|\n|Zachary L'Heureux |   2024|      6|      0.62|         0|     0.1033333|\n|Dylan McIlrath    |   2024|      7|      0.57|         0|     0.0814286|\n|Jakub Vrana       |   2024|      1|      0.08|         0|     0.0800000|\n|Kasperi Kapanen   |   2024|      5|      0.38|         0|     0.0760000|\n|Nolan Allan       |   2024|      8|      0.47|         0|     0.0587500|\n|Steven Santini    |   2024|     18|      0.85|         0|     0.0472222|\n|Urho Vaakanainen  |   2024|      9|      0.38|         0|     0.0422222|\n|Riley Stillman    |   2024|      1|      0.04|         0|     0.0400000|\n|Scott Mayfield    |   2024|     28|      1.07|         0|     0.0382143|\n|Denton Mateychuk  |   2024|     16|      0.56|         0|     0.0350000|\n|Derek Forbort     |   2024|     27|      0.93|         0|     0.0344444|\n\n\n:::\n:::\n\n\n\n\n\nThis table highlights players who consistently generate positive expected goal impact during their shifts.\n\n---\n\n### 4.2 Distribution of Shift Efficiency\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x = avg_shift_eff)) +\n  geom_histogram(bins = 40, fill = \"steelblue\", alpha = 0.75) +\n  labs(\n    title = \"Distribution of Average Shift Efficiency\",\n    x = \"Average Shift Efficiency\",\n    y = \"Number of Players\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 365 rows containing non-finite outside the scale range\n(`stat_bin()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](rq1_details_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\nThe distribution shows that most players cluster around neutral efficiency, while a smaller subset exhibits consistently strong positive or negative contributions.\n\n---\n\n### 4.3 Relationship Between TOI and Shift Efficiency\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x = toi, y = avg_shift_eff)) +\n  geom_point(alpha = 0.6) +\n  geom_smooth(method = \"loess\", se = FALSE) +\n  labs(\n    title = \"Average Shift Efficiency vs Time on Ice\",\n    x = \"Time on Ice\",\n    y = \"Average Shift Efficiency\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 365 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 365 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](rq1_details_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n\nThis visualization examines whether higher ice-time players maintain efficiency or regress due to fatigue and tougher matchups.\n\n---\n\n## 5. Interpretation\n\nPlayers with high average shift efficiency contribute positively in short, repeatable segments of play, indicating strong two-way impact. Importantly, efficiency does not scale linearly with ice time, suggesting that role and deployment significantly influence performance.\n\nThese findings reinforce the value of shift-normalized metrics when comparing players across teams and usage levels.\n\n---\n\n## 6. Conclusion\n\nRQ1 demonstrates that expected-goal-based shift efficiency provides a nuanced and fair evaluation of player performance. This metric serves as a foundation for subsequent analyses that explore contextual factors such as zone starts, usage, and on-ice teammates in later research questions.\n\n",
    "supporting": [
      "rq1_details_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "ed69cb56dd3d3436fb0605001c04c619",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"RQ2 — Predicting Special Teams Versatility Score (STVS)\"\nformat:\n  html:\n    theme: cosmo\n    toc: true\n    code-fold: true\n---\n\n\n\n## 1. Introduction\n\nThis section provides the detailed empirical analysis for **Research Question 2**, focusing on identifying players who demonstrate strong versatility on special teams. Rather than evaluating power-play (PP) and penalty-kill (PK) performance in isolation, we construct a unified metric—the **Special Teams Versatility Score (STVS)**—that captures both offensive and defensive contributions.\n\n---\n\n## 2. Data Loading and Preparation\n\n### 2.1 Load Libraries\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tidyverse' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'ggplot2' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tibble' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tidyr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'readr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'purrr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'dplyr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'stringr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'forcats' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'lubridate' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(knitr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'knitr' was built under R version 4.5.2\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(randomForest)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'randomForest' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nrandomForest 4.7-1.2\nType rfNews() to see new features/changes/bug fixes.\n\nAttaching package: 'randomForest'\n\nThe following object is masked from 'package:dplyr':\n\n    combine\n\nThe following object is masked from 'package:ggplot2':\n\n    margin\n```\n\n\n:::\n:::\n\n\n\n\n\n\n### 2.2 Load Dataset\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read_csv(\"D:/GMU homeworks/STAT515/final proj/skaters.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 4600 Columns: 154\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (4): name, team, position, situation\ndbl (150): playerId, season, games_played, icetime, shifts, gameScore, onIce...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n\n\n\n### 2.3 Standardize Naming Conventions\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df %>%\n  rename(\n    player = name,\n    toi = icetime\n  )\n```\n:::\n\n\n\n\n\n---\n\n## 3. Variable Selection and Validation\n\n### 3.1 Required Columns\n\nWe use on-ice expected-goals metrics as proxies for special-teams performance.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreq_cols <- c(\n  \"player\",\n  \"season\",\n  \"OnIce_F_xGoals\",\n  \"OnIce_A_xGoals\",\n  \"toi\"\n)\n\nmissing_cols <- setdiff(req_cols, names(df))\nif (length(missing_cols) > 0) {\n  stop(\"Missing required columns: \", paste(missing_cols, collapse = \", \"))\n}\n```\n:::\n\n\n\n\n\n---\n\n## 4. Constructing the STVS Metric\n\n### 4.1 Power Play and Penalty Kill Proxies\n\n* **PP Impact**: On-ice expected goals for\n* **PK Impact**: Negative of on-ice expected goals against\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df %>%\n  mutate(\n    pp_impact = as.numeric(OnIce_F_xGoals),\n    pk_impact = -as.numeric(OnIce_A_xGoals)\n  )\n```\n:::\n\n\n\n\n\n### 4.2 Standardization\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df %>%\n  mutate(\n    pp_z = scale(pp_impact)[,1],\n    pk_z = scale(pk_impact)[,1],\n    STVS = pp_z + pk_z\n  )\n```\n:::\n\n\n\n\n\n---\n\n## 5. Exploratory Analysis\n\n### 5.1 Distribution of STVS\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x = STVS)) +\n  geom_histogram(bins = 40, fill = \"darkorange\", alpha = 0.75) +\n  labs(\n    title = \"Distribution of Special Teams Versatility Score\",\n    x = \"STVS\",\n    y = \"Number of Players\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](rq2_details_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n---\n\n### 5.2 Top Players by STVS\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n  arrange(desc(STVS)) %>%\n  select(player, season, STVS, pp_impact, pk_impact) %>%\n  head(15) %>%\n  kable(caption = \"Top Players by Special Teams Versatility Score\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Top Players by Special Teams Versatility Score\n\n|player              | season|     STVS| pp_impact| pk_impact|\n|:-------------------|------:|--------:|---------:|---------:|\n|Evan Bouchard       |   2024| 2.330029|    144.55|    -80.19|\n|Leon Draisaitl      |   2024| 2.279387|    127.90|    -65.88|\n|Connor McDavid      |   2024| 2.105995|    119.04|    -61.73|\n|Zach Hyman          |   2024| 2.079760|    112.78|    -56.52|\n|Nathan MacKinnon    |   2024| 2.026877|    142.69|    -85.63|\n|Jack Hughes         |   2024| 1.881707|    109.22|    -57.89|\n|Tomas Hertl         |   2024| 1.847657|    102.74|    -52.66|\n|Jesper Bratt        |   2024| 1.732644|     46.18|     -2.70|\n|Nikita Kucherov     |   2024| 1.719423|    129.92|    -81.01|\n|Carter Verhaeghe    |   2024| 1.686687|    115.55|    -68.40|\n|Nico Hischier       |   2024| 1.675657|     45.28|     -3.21|\n|Shayne Gostisbehere |   2024| 1.617022|     95.11|    -51.01|\n|Sam Reinhart        |   2024| 1.593483|     41.55|     -1.68|\n|Matthew Tkachuk     |   2024| 1.533775|     87.23|    -45.64|\n|Dougie Hamilton     |   2024| 1.530612|    100.57|    -58.14|\n\n\n:::\n:::\n\n\n\n\n\n---\n\n## 6. Predictive Modeling: Random Forest\n\n### 6.1 Model Data Preparation\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_data <- df %>%\n  select(STVS, pp_impact, pk_impact, toi) %>%\n  drop_na()\n```\n:::\n\n\n\n\n\n### 6.2 Train Random Forest Model\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(515)\nrf_model <- randomForest(\n  STVS ~ pp_impact + pk_impact + toi,\n  data = rf_data,\n  importance = TRUE\n)\n```\n:::\n\n\n\n\n\n---\n\n### 6.3 Feature Importance\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvarImpPlot(rf_model, main = \"Random Forest Feature Importance for STVS\")\n```\n\n::: {.cell-output-display}\n![](rq2_details_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\n\n---\n\n## 7. Interpretation\n\nThe Random Forest model highlights both offensive (PP) and defensive (PK) components as critical drivers of special-teams versatility. Time on ice further moderates these effects, reflecting coaching trust and deployment context.\n\nPlayers with high STVS scores are therefore those who consistently contribute under both numerical advantage and disadvantage.\n\n---\n\n## 8. Conclusion\n\nRQ2 demonstrates that special-teams versatility can be quantified using a composite expected-goals-based metric. The STVS framework provides teams with a data-driven approach to identifying multi-role contributors and optimizing lineup decisions.\n\n➡️ **Next:** `rq3.qmd` — On-Ice vs Off-Ice Impact Delta\n",
    "supporting": [
      "rq2_details_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}